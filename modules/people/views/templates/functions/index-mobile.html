{% extends "base-mobile.html" %}

{% block title %}{{ _("Functions") }}{% endblock %}

{% block additional_styles %}
<style>
    .functions-container {
        padding: 1rem;
    }

    .mobile-header {
        background: transparent;
    }

    .section-header {
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0rem 0 0.5rem 0;
        color: #000;
    }

    .functions-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .function-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        margin-bottom: 0.8rem;
        background: white;
        border-radius: 15px;
        text-decoration: none;
        color: inherit;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .function-icon {
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
    }

    .function-icon i {
        font-size: 1.4rem;
        color: white;
    }

    .function-title {
        font-size: 1.2rem;
        font-weight: 500;
        margin: 0;
    }

    /* Icon colors */
    .icon-dashboard { background: var(--module-color, #0d6efd); }
    .icon-employees { background: var(--module-color, #0d6efd); }
    .icon-chat { background: var(--module-color, #0d6efd); }
    .icon-hiring { background: #198754; }
    .icon-onboarding { background: #6610f2; }
    .icon-pto { background: #fd7e14; }
    .icon-time { background: #dc3545; }
    .icon-scheduling { background: #0dcaf0; }
    .icon-forms { background: #20c997; }
    .icon-docs { background: #6c757d; }
    .icon-knowledge { background: #d63384; }

    /* View Transitions */
    ::view-transition-old(root),
    ::view-transition-new(root) {
        animation-duration: 500ms;
        animation-timing-function: cubic-bezier(0.32, 0.72, 0, 1);
        animation-direction: normal;
    }

    ::view-transition-old(root) {
        animation-name: slide-out;
    }

    ::view-transition-new(root) {
        animation-name: slide-in;
        mix-blend-mode: normal;
    }

    .back-transition::view-transition-new(root) {
        animation-name: slide-out-reverse;
    }

    .back-transition::view-transition-old(root) {
        animation-name: slide-in-reverse;
        mix-blend-mode: normal;
        z-index: 1;
    }

    @keyframes slide-out {
        from { transform: translateX(0); }
        to { transform: translateX(-20%); }
    }

    @keyframes slide-out-reverse {
        from { transform: translateX(-20%); }
        to { transform: translateX(0); }
    }

    @keyframes slide-in {
        from { transform: translateX(100%); }
        to { transform: translateX(0); }
    }

    @keyframes slide-in-reverse {
        from { transform: translateX(0); }
        to { transform: translateX(100%); }
    }

    @media (prefers-color-scheme: dark) {
        .search-bar {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        .section-header {
            color: #fff;
        }

        .function-item {
            background: #2d2d2d;
        }

        .search-bar::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .mobile-header {
            background: transparent;
        }
    }

    /* Apps Dropdown */
    .apps-dropdown {
        position: absolute;
        top: calc(var(--header-height) + var(--safe-area-inset-top));
        right: 1rem;
        background: white;
        padding: 1rem;
        border-radius: 1rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        z-index: 1010;
        width: 90%;
        max-width: 300px;
        margin-top: -0.5rem;
        display: none;
    }

    .apps-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
    }

    .app-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 0.5rem;
        color: inherit;
        text-decoration: none;
        padding: 0.75rem;
        border-radius: 0.5rem;
    }

    .app-item:hover {
        background: rgba(0,0,0,0.05);
    }

    .app-item i {
        font-size: 1.5rem;
        color: var(--app-color, #6c757d);
    }

    .app-item span {
        font-size: 0.75rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
    }

    @media (prefers-color-scheme: dark) {
        .apps-dropdown {
            background: #2d2d2d;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .app-item:hover {
            background: rgba(255,255,255,0.1);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="mobile-header" style="background: transparent;">
    <a href="{{ url_for('core_bp.index') }}" class="logo-link">
        <img src="{{ url_for('core_bp.static', filename='images/sparq-logo.png') }}" alt="sparQ" class="app-logo" style="height: 24px; width: auto;">
    </a>
    <div class="header-title">
        <div class="icon-wrapper">
            <i class="{{ g.current_module.icon_class }}"></i>
        </div>
        <h1>{{ g.current_module.name }}</h1>
    </div>
    <button class="apps-toggle" onclick="toggleApps()" style="background: none; border: none; padding: 0.5rem; margin: -0.5rem; color: #6c757d; font-size: 1.25rem;">
        <i class="fas fa-th"></i>
    </button>
</div>

<!-- Apps Dropdown -->
<div id="appsDropdown" class="apps-dropdown" style="display: none;">
    <div class="apps-grid">
        {% for mod in g.installed_modules|sort(attribute='name') %}
            {% if mod.type == 'App' and mod.enabled %}
                <a href="{{ mod.main_route }}" 
                   class="app-item {{ mod.name|lower }}-app" 
                   data-app="{{ mod.name }}"
                   style="--app-color: {{ mod.color|default('#6c757d') }}">
                    <i class="{{ mod.icon_class }}"></i>
                    <span>{{ mod.name }}</span>
                </a>
            {% endif %}
        {% endfor %}
    </div>
</div>

<div class="functions-container">
    <h2 class="section-header">{{ _("Core") }}</h2>
    <div class="functions-list">
        <a href="{{ url_for('people_bp.dashboard') }}" 
           class="function-item">
            <div class="function-icon icon-dashboard">
                <i class="fas fa-chart-line"></i>
            </div>
            <h3 class="function-title">{{ _("Dashboard") }}</h3>
        </a>
        <a href="{{ url_for('people_bp.chat') }}" 
           class="function-item"
           hx-get="{{ url_for('people_bp.chat') }}"
           hx-target="body"
           hx-push-url="true"
           hx-trigger="click"
           hx-swap="none">
            <div class="function-icon icon-chat">
                <i class="fas fa-comments"></i>
            </div>
            <h3 class="function-title">{{ _("Chat") }}</h3>
        </a>
        <a href="{{ url_for('people_bp.employees') }}" class="function-item">
            <div class="function-icon icon-employees">
                <i class="fas fa-users"></i>
            </div>
            <h3 class="function-title">{{ _("Team") }}</h3>
        </a>
    </div>

    <h2 class="section-header">{{ _("Talent Management") }}</h2>
    <div class="functions-list">
        <a href="{{ url_for('people_bp.hiring') }}" class="function-item">
            <div class="function-icon icon-hiring">
                <i class="fas fa-user-plus"></i>
            </div>
            <h3 class="function-title">{{ _("Hiring") }}</h3>
        </a>
        <a href="{{ url_for('people_bp.onboarding') }}" class="function-item">
            <div class="function-icon icon-onboarding">
                <i class="fas fa-handshake"></i>
            </div>
            <h3 class="function-title">{{ _("Onboarding") }}</h3>
        </a>
    </div>
    <h2 class="section-header">{{ _("Time Management") }}</h2>
    <div class="functions-list">
        <a href="{{ url_for('people_bp.timeoff') }}" class="function-item">
            <div class="function-icon icon-pto">
                <i class="fas fa-umbrella-beach"></i>
            </div>
            <h3 class="function-title">{{ _("Time Off") }}</h3>
        </a>
        <a href="{{ url_for('people_bp.time_tracking') }}" class="function-item">
            <div class="function-icon icon-time">
                <i class="fas fa-clock"></i>
            </div>
            <h3 class="function-title">{{ _("Time Tracking") }}</h3>
        </a>
        <a href="{{ url_for('people_bp.scheduling') }}" class="function-item">
            <div class="function-icon icon-scheduling">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <h3 class="function-title">{{ _("Shift Scheduling") }}</h3>
        </a>
    </div>

    <h2 class="section-header">{{ _("Resources") }}</h2>
    <div class="functions-list">
        <a href="{{ url_for('people_bp.forms') }}" class="function-item">
            <div class="function-icon icon-forms">
                <i class="fas fa-file-alt"></i>
            </div>
            <h3 class="function-title">{{ _("Forms") }}</h3>
        </a>
        <a href="{{ url_for('people_bp.docs') }}" class="function-item">
            <div class="function-icon icon-docs">
                <i class="fas fa-folder"></i>
            </div>
            <h3 class="function-title">{{ _("Documents") }}</h3>
        </a>
        <a href="{{ url_for('people_bp.knowledge') }}" class="function-item">
            <div class="function-icon icon-knowledge">
                <i class="fas fa-book"></i>
            </div>
            <h3 class="function-title">{{ _("Knowledge Base") }}</h3>
        </a>
    </div>
</div>


{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    function toggleApps() {
        const dropdown = document.getElementById('appsDropdown');
        if (dropdown.style.display === 'block') {
            dropdown.style.display = 'none';
        } else {
            dropdown.style.display = 'block';
        }
    }
</script>
{% endblock %} 